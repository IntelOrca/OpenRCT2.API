@page "/{Name}/edit"

@if (Error == null && User == null)
{
    <LoadingAnimation />
}
else if (User != null)
{
    <h2>Editing @User.Name</h2>
    <form role="form" @onsubmit="OnSubmit">
        <hr />
        <div class="row mb-3">
            <label for="signup-user" class="col-sm-2 col-form-label">User name</label>
            <div class="col-sm-6">
                <FormTextBox Id="useredit-name"
                             ReadOnly="@(!HasAdminEditFeatures)"
                             Value="@InputName" />
                @if (HasAdminEditFeatures)
                {
                    <div class="form-text">
                        Changing the user name is exclusive to administrators. The user may need to sign out and back in again after the edit is applied.
                    </div>
                }
                else
                {
                    <div class="form-text">
                        <a href="/contact">Contact</a> an administrator if you wish to change your user name.
                    </div>
                }
            </div>
        </div>
        <div class="row mb-3">
            <label for="useredit-email" class="col-sm-2 col-form-label">Account Status</label>
            <div class="col-sm-3">
                @if (HasAdminEditFeatures)
                {
                    <select class="form-select" id="useredit-accountstatus" @bind="@InputStatus">
                        @foreach (var value in Enum.GetValues<UserAccountStatus>())
                        {
                            <option value="@value">@value.ToSpaceyString()</option>
                        }
                    </select>
                }
                else
                {
                    <input type="text" class="form-control-plaintext" id="useredit-accountstatus" readonly value="@User.Status">
                }
            </div>
        </div>
        @if (InputStatus == UserAccountStatus.Suspended)
        {
            <div class="row mb-3">
                <label for="useredit-email" class="col-sm-2 col-form-label">Suspension Reason</label>
                <div class="col-sm-10">
                    <textarea class="form-control" id="useredit-suspension-reason" rows="3" @bind="InputSuspensionReason"></textarea>
                </div>
            </div>
        }
        <div class="row mb-3">
            <label for="useredit-email-current" class="col-sm-2 col-form-label">Secret Key</label>
            <div class="col-sm-10">
                <div class="row">
                    <div class="col-sm-auto">
                        <SecretKeyTextBox Value="@User.SecretKey" />
                    </div>
                    <div class="col-sm-auto">
                        <button class="btn btn-warning" type="button" @onclick="OnGenerateSecretKey">
                            @if (IsGeneratingSecret)
                            {
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                  <span class="visually-hidden">Waiting...</span>
                                </div>
                            }
                            else
                            {
                                <Icon Kind="arrow-clockwise" />
                            }
                        </button>
                    </div>
                </div>
                <div class="form-text">
                    Only send this secret key to an administrator, to prove you own this account.
                </div>
            </div>
        </div>
        <hr />
        <div class="row mb-3">
            <label for="useredit-email-current" class="col-sm-2 col-form-label">Current Email</label>
            <div class="col-sm-10">
                <FormTextBox Id="useredit-email-current"
                             Type="email"
                             ReadOnly="@(!HasAdminEditFeatures)"
                             Value="@InputEmailCurrent" />
                @if (HasAdminEditFeatures)
                {
                    <div class="form-text">
                        Changing the current email address will bypass email verification. This feature is exclusive to administrators.
                    </div>
                }
            </div>
        </div>
        <div class="row mb-3">
            <label for="useredit-email-new" class="col-sm-2 col-form-label">New Email</label>
            <div class="col-sm-10">
                <FormTextBox Id="useredit-email-new"
                             Type="email"
                             Value="@InputEmailNew" />
                <div class="form-text">
                    Your new email address will need to be verified.
                </div>
            </div>
        </div>
        <hr />
        <div class="row mb-3">
            <label for="useredit-password" class="col-sm-2 col-form-label">New Password</label>
            <div class="col-sm-10">
                <FormTextBox Id="useredit-password"
                             Type="password"
                             Value="@InputPassword" />
            </div>
        </div>
        <div class="row mb-3">
            <label for="useredit-password-confirm" class="col-sm-2 col-form-label">Confirm Password</label>
            <div class="col-sm-10">
                <FormTextBox Id="useredit-password-confirm"
                             Type="password"
                             Value="@InputPasswordConfirm" />
            </div>
        </div>
        <hr />
        <div class="row mb-3">
            <label for="useredit-bio" class="col-sm-2 col-form-label">Bio</label>
            <div class="col-sm-10">
                <textarea class="form-control" id="useredit-bio" rows="5" @bind="InputBio"></textarea>
            </div>
        </div>
        <hr />
        @if (InputForm.IsValid == false && InputForm.Message != null)
        {
            <p class="text-danger">@InputForm.Message</p>
        }
        <button type="submit" class="btn btn-primary px-5 me-2">Save</button>
        <a class="btn btn-secondary" href="/@Name">Cancel</a>
    </form>
}
else
{
    <Error Context="@Error" />
}
